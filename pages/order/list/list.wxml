<!--pages/order/list/list.wxml-->
<view class="container">
  <!-- 订单状态标签 -->
  <scroll-view class="tab-bar" scroll-x="true">
    <view class="tab-item {{currentTab === index ? 'active' : ''}}" 
          wx:for="{{tabs}}" wx:key="id" wx:for-index="index"
          bindtap="onTabTap" data-index="{{index}}">
      <text>{{item.name}}</text>
    </view>
  </scroll-view>

  <!-- 订单列表 -->
  <view class="order-list" wx:if="{{!loading && orders.length > 0}}">
    <view class="order-item" wx:for="{{orders}}" wx:key="id">
      <!-- 订单头部 -->
      <view class="order-header" bindtap="onOrderTap" data-order-id="{{item.id}}">
        <view class="order-info">
          <text class="order-id">订单号：{{item.id}}</text>
          <text class="order-time">{{item.createTime}}</text>
        </view>
        <text class="order-status">{{item.statusText}}</text>
      </view>

      <!-- 商品列表 -->
      <view class="product-list">
        <view class="product-item" wx:for="{{item.items}}" wx:for-item="product" wx:key="id">
          <image class="product-image" src="{{product.image}}" mode="aspectFill" />
          <view class="product-info">
            <text class="product-name">{{product.name}}</text>
            <text class="product-specs" wx:if="{{product.specs}}">{{product.specs}}</text>
            <view class="product-price-quantity">
              <text class="product-price">¥{{product.price}}</text>
              <text class="product-quantity">x{{product.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 订单总价 -->
      <view class="order-total">
        <text>共{{item.items.length}}件商品 合计：</text>
        <text class="total-amount">¥{{item.totalAmount}}</text>
      </view>

      <!-- 操作按钮 -->
      <view class="order-actions">
        <!-- 待付款状态 -->
        <block wx:if="{{item.status === 'pending'}}">
          <view class="action-btn cancel-btn" bindtap="onCancelOrder" data-order-id="{{item.id}}">
            <text>取消订单</text>
          </view>
          <view class="action-btn primary-btn" bindtap="onPayOrder" data-order-id="{{item.id}}">
            <text>去付款</text>
          </view>
        </block>
        
        <!-- 待发货状态 -->
        <block wx:if="{{item.status === 'paid'}}">
          <view class="action-btn cancel-btn" bindtap="onCancelOrder" data-order-id="{{item.id}}">
            <text>申请退款</text>
          </view>
        </block>
        
        <!-- 待收货状态 -->
        <block wx:if="{{item.status === 'shipped'}}">
          <view class="action-btn primary-btn" bindtap="onConfirmReceive" data-order-id="{{item.id}}">
            <text>确认收货</text>
          </view>
        </block>
        
        <!-- 已完成状态 -->
        <block wx:if="{{item.status === 'completed'}}">
          <view class="action-btn cancel-btn" bindtap="onDeleteOrder" data-order-id="{{item.id}}">
            <text>删除订单</text>
          </view>
          <view class="action-btn primary-btn">
            <text>再次购买</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
    <image class="empty-image" src="/images/empty-order.png" />
    <text class="empty-text">暂无订单</text>
    <navigator url="/pages/index/index" class="go-shopping">
      <text>去逛逛</text>
    </navigator>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>
</view>